# BugRicer - Proper MIME Type Configuration
# This file ensures JavaScript and other assets are served correctly

# CRITICAL: Set MIME types BEFORE any rewrite rules
<IfModule mod_mime.c>
    # JavaScript files - MUST be set first
    AddType application/javascript .js
    AddType application/javascript .mjs
    AddType text/css .css
    AddType text/html .html
    AddType application/json .json
</IfModule>

# Enable rewrite engine
RewriteEngine On
RewriteBase /

# IMPORTANT: Don't rewrite existing files or directories
# This prevents JavaScript/CSS files from being redirected to index.html
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Only rewrite non-existent paths to index.html for SPA routing
RewriteRule ^.*$ /index.html [QSA,L]

# Set security headers - BUT NOT for JavaScript files to avoid conflicts
<IfModule mod_headers.c>
    # Set headers ONLY for HTML files to avoid interfering with JavaScript
    <FilesMatch "\.(html)$">
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-XSS-Protection "1; mode=block"
        Header set Referrer-Policy "strict-origin-when-cross-origin"
        # CSP disabled to prevent syntax errors - set via meta tag if needed
    </FilesMatch>
    
    # For JavaScript files, ONLY set MIME-related headers
    <FilesMatch "\.(js|mjs)$">
        Header set Content-Type "application/javascript; charset=utf-8"
        Header set X-Content-Type-Options "nosniff"
        # NO CSP headers here - prevents "CSP" syntax errors
    </FilesMatch>
</IfModule>


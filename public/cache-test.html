<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Clearing Test - BugRicer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§¹ Cache Clearing Test</h1>
        <p>This page helps verify that browser cache has been cleared and the development server is working correctly.</p>
        
        <div id="status">
            <h2>Status Check</h2>
            <div id="checks"></div>
        </div>
        
        <div id="actions">
            <h2>Actions</h2>
            <button onclick="clearAllCaches()">Clear All Caches</button>
            <button onclick="testEndpoints()">Test Endpoints</button>
            <button onclick="reloadWithoutCache()">Reload Without Cache</button>
        </div>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        const log = document.getElementById('log');
        const checks = document.getElementById('checks');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            log.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        }
        
        function addCheck(name, status, message) {
            const className = status === 'success' ? 'success' : status === 'error' ? 'error' : 'warning';
            checks.innerHTML += `<div class="${className}">${name}: ${message}</div>`;
        }
        
        async function clearAllCaches() {
            addLog('ðŸ§¹ Starting cache clearing process...', 'info');
            
            // Clear caches
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    for (const name of cacheNames) {
                        await caches.delete(name);
                        addLog(`âœ… Cleared cache: ${name}`, 'success');
                    }
                } catch (e) {
                    addLog(`âŒ Error clearing caches: ${e.message}`, 'error');
                }
            }
            
            // Clear localStorage
            try {
                localStorage.clear();
                addLog('âœ… Cleared localStorage', 'success');
            } catch (e) {
                addLog(`âš ï¸ Could not clear localStorage: ${e.message}`, 'warning');
            }
            
            // Clear sessionStorage
            try {
                sessionStorage.clear();
                addLog('âœ… Cleared sessionStorage', 'success');
            } catch (e) {
                addLog(`âš ï¸ Could not clear sessionStorage: ${e.message}`, 'warning');
            }
            
            addLog('ðŸŽ‰ Cache clearing complete!', 'success');
        }
        
        async function testEndpoints() {
            addLog('ðŸ§ª Testing critical endpoints...', 'info');
            
            const endpoints = [
                '/',
                '/src/pages/Projects.tsx',
                '/node_modules/.vite/deps/framer-motion.js',
                '/node_modules/.vite/deps/react-dom.js'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    if (response.ok) {
                        addLog(`âœ… ${endpoint}: OK (${response.status})`, 'success');
                        addCheck(endpoint, 'success', 'OK');
                    } else {
                        addLog(`âš ï¸ ${endpoint}: Status ${response.status}`, 'warning');
                        addCheck(endpoint, 'warning', `Status ${response.status}`);
                    }
                } catch (e) {
                    addLog(`âŒ ${endpoint}: ${e.message}`, 'error');
                    addCheck(endpoint, 'error', e.message);
                }
            }
        }
        
        function reloadWithoutCache() {
            addLog('ðŸ”„ Reloading page without cache...', 'info');
            window.location.reload(true);
        }
        
        // Auto-run tests on page load
        window.addEventListener('load', () => {
            addLog('ðŸš€ Cache clearing test page loaded', 'info');
            testEndpoints();
        });
    </script>
</body>
</html>